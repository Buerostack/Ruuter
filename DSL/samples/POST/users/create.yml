validate:
  switch:
    - condition: ${!incoming.body || !incoming.body.name || !incoming.body.email}
      next: bad_request
  next: define_output

define_output:
  assign:
    output:
      id: "${'usr-' + Date.now()}"
      name: ${incoming.body.name}
      email: ${incoming.body.email}
      role: ${incoming.body.role ?? "user"}
  next: create

create:
  status: 201
  return: ${output}
  next: end

bad_request:
  status: 400
  return: Missing at least one of the required fields - 'name, email', with 'role' optional
  next: end
